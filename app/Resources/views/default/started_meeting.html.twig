{% extends 'base.html.twig' %}

{% block head %}
    <title>Meeting gestartet</title>
{% endblock %}

{% block body %}
<h1>Meeting gestartet</h1>
<h2>Name des Meetings: {{ meeting_name }}</h2>
<br />

    <div id = "countdownExample">
    {% for agenda in agendas %}
        <h4><td>Agendapunkt: {{ agenda.name }}   Minuten: <span class="values" data-time="{{ 100*agenda.minutes }}" id="time_{{ loop.index }}" data-tid="{{ loop.index }}">{{ 1000*agenda.minutes }}</span></td><br /></h4>
    {% endfor %}
    </div>
 
    <button class="js-stop" data-target="">Skip</button>
    

<script>

    $(document).ready(function () {
        'use strict';

        var timersElements = $('[data-time]'),
        timers = [];
        console.log(timersElements);
        var dir;
        var i = 1;

        $.each(timersElements, function (k, timerElement) {
            var t = {
                "active" : false,
                "id" : $(timerElement).attr('id'),
                "time": parseInt($(timerElement).data('time'), 10),
                "target": $(timerElement).data('target'),
                "dir": "down",
                {#i": 1,#}

                "interval": setInterval(function () {
                    console.log(this.dir = dir);
                    if(dir == "up"){
                        if(t.active == true){
                            t.time = t.time + 1;
                            if (t.time >= 0) {
                                t.show();
                            } else {
                                dir = "down";
                            }
                        }   
                    }  
                    if (dir == "down"){
                       if(t.active == true){
                            t.time = t.time - 1;
                            if (t.time >= 0) {
                                t.show();
                            } else {
                                dir = "up";
                            }
                        } 
                    }
                }, 1),

                "nextElement": function(){
                    var index = timers.indexOf('[data-time]');
                        if(index >= 0 && index < array.length - 1)
                        var nextItem = array[index + 1];
                        nextItem.countdown();
                },
                "show": function () {
                    $(timerElement).text(this.time);
                },
                "countdown": function () {
                    dir = "down"
                    t.active = true;
                    t.interval();

                },
                "countup": function(){
                    t.active = true;
                    dir = "up";
                    t.interval();
                },       
                "stop":  function(){  
                    $.each(timers, function(index){
                        if(t.active = true){
                            var tElement = jQuery('#time_' +(this.id));
                            window.clearInterval(t.interval);
                            t.active = false;
                            this.id = i++;

                            console.log('stop this.id:' + this.id);
                            tElement.active = true;
                            //timers[t.id].countdown(); 
                            timers[this.id].countdown(); 

                        }
                        else{
                            console.log("t ist nicht aktiv");    
                        }
                    }); 
                }
            };

            timers[k] = t;

            $('.js-stop').click(function () {
                var objectId = $('.active').data('tid') + 1;
                var timerId = $('.active').data('tid') - 1;
                $('.active').removeClass('active');
                $('#time_' + objectId).addClass('active');
                console.log(objectId + ' : ' + timerId);
                timers[timerId].stop();
            });

        });

        $('#time_1').addClass('active');
        timers[0].countdown();

        $.each(timers, function (k, timer) {
            if (timer.active == true) {
                timer.stop();
            } 
        });


    });

</script>

{% endblock %}
